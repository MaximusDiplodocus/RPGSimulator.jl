# New Book

```julia (editor=true, logging=true, output=true)
using Bonito, DataFrames
using RPGSimulator

# -----------------------------
# Création des personnages
# -----------------------------
archer = Archer(nom="Jed")
archer.stats = Stats(PV=100, PM=20, ATK=30, VITESSE=40, DEFENSE=10)

gobelin = Gobelin(nom="Hussin")
gobelin.stats = Stats(PV=120, PM=0, ATK=35, VITESSE=40, DEFENSE=5)

# -----------------------------
# Simulation des combats
# -----------------------------
n_simulations = 5
winners = String[]

for i in 1:n_simulations
    # Copie indépendante pour chaque simulation
    f1, f2 = deepcopy(archer), deepcopy(gobelin)
    
    # Lancer le combat
    winner, logs = combat(f1, f2; max_rounds=50)
    
    # Enregistrer le vainqueur
    push!(winners, winner)
end

# -----------------------------
# Préparer le résumé
# -----------------------------
summary_df = DataFrame(Simulation=1:n_simulations, Winner=winners)

# -----------------------------
# Affichage avec BonitoBook
# -----------------------------
Bonito.DOM.div(
    Bonito.DOM.h2("Résumé des combats"),
    Bonito.Table(summary_df)
)
```
```julia (editor=true, logging=true, output=true)
using Bonito, DataFrames
using RPGSimulator

# Création des personnages
archer = Archer(nom="Jed")
archer.stats = Stats(PV=100, PM=20, ATK=30, VITESSE=40, DEFENSE=10)

gobelin = Gobelin(nom="Hussin")
gobelin.stats = Stats(PV=120, PM=0, ATK=35, VITESSE=40, DEFENSE=5)

# Lancer un seul combat
f1, f2 = deepcopy(archer), deepcopy(gobelin)
winner, logs = combat(f1, f2; max_rounds=50)

# Préparer les données PV par round
round_numbers = sort(unique([log.round for log in logs]))  # tous les rounds
jed_pv = Int[]
hussin_pv = Int[]

for r in round_numbers
    # PV du dernier log de l'archer pour ce round
    logs_round = [log for log in logs if log.round == r]
    push!(jed_pv, logs_round[end].actor_PV)  # PV après le dernier action de ce round
    push!(hussin_pv, logs_round[end].target_PV)  # PV de l'autre
end

df_pv = DataFrame(
    Round = round_numbers,
    Jed_PV = jed_pv,
    Hussin_PV = hussin_pv
)

# Affichage dans Bonito
Bonito.DOM.div(
    Bonito.DOM.h2("Points de vie par round"),
    Bonito.Table(df_pv)
)

```
```julia (editor=true, logging=false, output=true)
# Simulation / exemple de données DEFENSE par round
defense_data = DataFrame(combat=Int[], round=Int[], actor=String[], defense=Int[])

# Simule données pour 2 personnages sur 5 rounds
for combat_id in 1:3
    for round in 0:5
        push!(defense_data, (combat_id, round, "Jed", max(10, 20 - round)))
        push!(defense_data, (combat_id, round, "Hussin", max(5, 15 - 2*round)))
    end
end

# Affichage avec Bonito
Bonito.DOM.div(
    Bonito.DOM.h2("Défense par round"),
    Bonito.Table(defense_data)
)

```
```julia (editor=true, logging=false, output=true)

```
```julia (editor=true, logging=false, output=true)
using Bonito, WGLMakie
using RPGSimulator

WGLMakie.activate!(; resize_to_body=true)

# -----------------------------
# Création des personnages
# -----------------------------
archer = Archer(nom="Jed")
archer.stats = Stats(PV=100, PM=20, ATK=30, VITESSE=40, DEFENSE=10)

gobelin = Gobelin(nom="Hussin")
gobelin.stats = Stats(PV=120, PM=0, ATK=35, VITESSE=40, DEFENSE=5)

# -----------------------------
# Lancer un combat
# -----------------------------
f1, f2 = deepcopy(archer), deepcopy(gobelin)
winner, logs = combat(f1, f2; max_rounds=50)

# -----------------------------
# Préparer les données PV par round
# -----------------------------
rounds = sort(unique([log.round for log in logs if log.action in ["attack", "skill"]]))
jed_pv = Float64[]
gob_pv = Float64[]

for r in rounds
    logs_round = [log for log in logs if log.round == r]
    
    # PV fin du round pour Jed
    jed_logs = [log.actor_PV for log in logs_round if log.actor == "Jed"]
    jed_end = isempty(jed_logs) ? jed_pv[end] : maximum(jed_logs)  # si vide, reprendre dernier PV
    
    # PV fin du round pour Gobelin
    gob_logs = [log.actor_PV for log in logs_round if log.actor == "Hussin"]
    gob_end = isempty(gob_logs) ? gob_pv[end] : maximum(gob_logs)
    
    push!(jed_pv, jed_end)
    push!(gob_pv, gob_end)
end

# -----------------------------
# Créer le graphique avec Makie
# -----------------------------
fig = Figure(resolution=(900,500))
ax = Axis(fig[1,1], title="Évolution des PV par round", xlabel="Round", ylabel="PV")
lines!(ax, rounds, jed_pv; color=:blue, linewidth=2, label="Jed")
lines!(ax, rounds, gob_pv; color=:red, linewidth=2, label="Gobelin")
axislegend(ax)

# -----------------------------
# Affichage dans BonitoBook
# -----------------------------
Bonito.DOM.div(
    Bonito.DOM.h2("Graphique des PV par round"),
    fig
)

```
```julia (editor=true, logging=false, output=true)

```
